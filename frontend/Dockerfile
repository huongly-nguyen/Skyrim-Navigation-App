ARG GITLAB_PROXY

FROM ${GITLAB_PROXY}node:22 AS build

WORKDIR /app

ARG REACT_APP_API_BASE_URL
ARG REACT_APP_KEYCLOAK_URL
ARG REACT_APP_KEYCLOAK_REALM
ARG REACT_APP_KEYCLOAK_CLIENT_ID
ARG REACT_APP_KEYCLOAK_REDIRECT_LOGIN
ARG REACT_APP_KEYCLOAK_REDIRECT_LOGOUT

ENV REACT_APP_API_BASE_URL=${REACT_APP_API_BASE_URL}
ENV REACT_APP_KEYCLOAK_URL=${REACT_APP_KEYCLOAK_URL}
ENV REACT_APP_KEYCLOAK_REALM=${REACT_APP_KEYCLOAK_REALM}
ENV REACT_APP_KEYCLOAK_CLIENT_ID=${REACT_APP_KEYCLOAK_CLIENT_ID}
ENV REACT_APP_KEYCLOAK_REDIRECT_LOGIN=${REACT_APP_KEYCLOAK_REDIRECT_LOGIN}
ENV REACT_APP_KEYCLOAK_REDIRECT_LOGOUT=${REACT_APP_KEYCLOAK_REDIRECT_LOGOUT}

COPY package.json package-lock.json ./
RUN npm install
RUN npm install axios
RUN npm install react-scripts@5.0.1 -g

COPY . ./
RUN npm run build
RUN npm install -g serve

CMD ["serve", "-s", "build", "-l", "4242"]
